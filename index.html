<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Calidad Sede Villa ‚Äì Smart OCR v3</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png" type="image/png"/>
<meta name="theme-color" content="#0e141b"/>
<style>
  :root{--bg:#0b1220;--card:#101922;--line:#1f2a37;--ink:#eaf2ff;--muted:#a9b6c5;--brand:#4cc9f0;--ok:#22c55e;--err:#ef4444}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter}
  header{position:sticky;top:0;z-index:10;background:#0b1220cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  h1{margin:6px 0 2px;font-size:19px}
  .sub{color:var(--muted);font-size:13px;margin-bottom:8px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px;margin-top:12px}
  button{appearance:none;border:1px solid transparent;background:var(--brand);color:#071018;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;margin-right:8px}
  .ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}
  .ok{background:var(--ok);color:#06140a}
  .danger{background:var(--err);color:white}
  input[type=file]{display:none}
  canvas{max-width:100%;border:1px solid var(--line);border-radius:12px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .cols{display:grid;grid-template-columns:1fr 2fr 1fr;gap:10px}
  .chip{font-size:12px;color:var(--muted);background:#0b1118;border:1px solid var(--line);padding:6px 8px;border-radius:999px;display:inline-block}
  .list{display:grid;gap:10px}
  .item{background:#0b1118;border:1px solid var(--line);padding:10px;border-radius:12px}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:#132235;border:1px solid var(--line)}
  .mini{font-size:12px;color:var(--muted)}
  .loader{display:none;align-items:center;gap:8px}
  .spin{width:16px;height:16px;border-radius:50%;border:2px solid #29425a;border-top-color:var(--brand);animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>OCR ‚Äì √ìrdenes de Venta (Smart v3)</h1>
    <div class="sub">Corta autom√°ticamente columnas <b>N¬∞</b>, <b>Descripci√≥n</b> y <b>Cant.</b> con <b>OpenCV.js</b> y aplica OCR por columna (Tesseract.js, spa).</div>
  </div>
</header>

<main class="wrap">
  <section class="card">
    <div style="display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap">
      <div>
        <label class="ghost" for="file">üì∑ Tomar foto / Subir imagen</label>
        <input id="file" type="file" accept="image/*" capture="environment"/>
        <button id="btnDetect" class="ghost" disabled>üß≠ Detectar tabla y cortar columnas</button>
        <button id="btnOCR" class="ghost" disabled>üîé OCR por columnas</button>
        <button id="btnClear" class="ghost">üóëÔ∏è Limpiar</button>
      </div>
      <div class="loader" id="loader"><span class="spin"></span><span>Procesando‚Ä¶</span></div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div>
        <div class="chip">Vista previa (auto-mejora y correcci√≥n leve)</div>
        <canvas id="canvas"></canvas>
        <div class="mini">Tip: encuadra principalmente la <b>tabla</b>, con buena luz y lo m√°s perpendicular posible.</div>
      </div>
      <div>
        <div class="chip">Recortes de columnas detectadas</div>
        <div class="cols" style="margin-top:8px">
          <div>
            <div class="mini">Col 1 ‚Ä¢ N¬∞</div>
            <canvas id="cCol1"></canvas>
          </div>
          <div>
            <div class="mini">Col 3 ‚Ä¢ Descripci√≥n</div>
            <canvas id="cCol3"></canvas>
          </div>
          <div>
            <div class="mini">Col 5 ‚Ä¢ Cant.</div>
            <canvas id="cCol5"></canvas>
          </div>
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="btnConfirm" class="ok" disabled>‚úÖ Confirmar columnas</button>
          <span id="colInfo" class="badge">Columnas: ‚Äì</span>
        </div>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="chip">Resultados extra√≠dos</div>
    <div id="results" class="list" style="margin-top:8px"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="btnExportJSON" class="ok" disabled>‚¨áÔ∏è Exportar JSON</button>
      <button id="btnExportCSV" class="ok" disabled>‚¨áÔ∏è Exportar CSV</button>
      <span id="count" class="badge">0 √≠tems</span>
    </div>
  </section>

  <p class="mini">Privacidad: todo se procesa <b>en tu navegador</b> (OpenCV.js + Tesseract.js). No se sube ninguna imagen.</p>
</main>

<script async src="https://docs.opencv.org/4.x/opencv.js" onload="cvOnReady()"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
  // c√≥digo OCR original (abreviado)
</script>
</body>
</html>
